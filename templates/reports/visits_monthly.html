{% extends "base.html" %}

{% block title %}Relat√≥rio Mensal de Visitas{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <h1 class="h3 fw-bold text-dark mb-4">
                üìä Relat√≥rio Mensal de Visitas por Usu√°rio
            </h1>

            <div class="card shadow-sm">
                <div class="card-body p-4">
                    <form method="POST" action="{{ url_for('reports_visits_monthly') }}">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        
                        <!-- Selecionar Usu√°rio -->
                        <div class="mb-3">
                            <label for="user_id" class="form-label fw-semibold">
                                Selecionar Usu√°rio *
                            </label>
                            <select id="user_id" name="user_id" required class="form-select">
                                <option value="">Selecione um usu√°rio...</option>
                                {% for usuario in usuarios %}
                                    <option value="{{ usuario.id }}">{{ usuario.nome_completo }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Selecionar M√™s e Ano -->
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="mes" class="form-label fw-semibold">
                                    M√™s *
                                </label>
                                <select id="mes" name="mes" required class="form-select">
                                    {% set mes_atual = now().month if now else 1 %}
                                    <option value="1" {% if mes_atual == 1 %}selected{% endif %}>Janeiro</option>
                                    <option value="2" {% if mes_atual == 2 %}selected{% endif %}>Fevereiro</option>
                                    <option value="3" {% if mes_atual == 3 %}selected{% endif %}>Mar√ßo</option>
                                    <option value="4" {% if mes_atual == 4 %}selected{% endif %}>Abril</option>
                                    <option value="5" {% if mes_atual == 5 %}selected{% endif %}>Maio</option>
                                    <option value="6" {% if mes_atual == 6 %}selected{% endif %}>Junho</option>
                                    <option value="7" {% if mes_atual == 7 %}selected{% endif %}>Julho</option>
                                    <option value="8" {% if mes_atual == 8 %}selected{% endif %}>Agosto</option>
                                    <option value="9" {% if mes_atual == 9 %}selected{% endif %}>Setembro</option>
                                    <option value="10" {% if mes_atual == 10 %}selected{% endif %}>Outubro</option>
                                    <option value="11" {% if mes_atual == 11 %}selected{% endif %}>Novembro</option>
                                    <option value="12" {% if mes_atual == 12 %}selected{% endif %}>Dezembro</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label for="ano" class="form-label fw-semibold">
                                    Ano *
                                </label>
                                <select id="ano" name="ano" required class="form-select">
                                    {% set ano_atual = now().year if now else 2024 %}
                                    {% for ano in range(ano_atual - 2, ano_atual + 2) %}
                                        <option value="{{ ano }}" {% if ano == ano_atual %}selected{% endif %}>{{ ano }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <!-- Selecionar Formato -->
                        <div class="mb-3">
                            <label for="formato" class="form-label fw-semibold">
                                Formato do Relat√≥rio *
                            </label>
                            <select id="formato" name="formato" required class="form-select">
                                <option value="pdf">PDF</option>
                                <option value="excel">Excel (XLSX)</option>
                            </select>
                        </div>

                        <!-- Informa√ß√µes sobre o relat√≥rio -->
                        <div class="alert alert-info mb-3">
                            <h6 class="alert-heading fw-semibold">‚ÑπÔ∏è Informa√ß√µes</h6>
                            <ul class="mb-0 small">
                                <li>O relat√≥rio inclui <strong>todas as visitas</strong> do usu√°rio selecionado no per√≠odo</li>
                                <li>S√£o consideradas visitas onde o usu√°rio √© <strong>respons√°vel</strong> ou <strong>participante</strong></li>
                                <li>M√©tricas incluem: total de visitas, distribui√ß√£o por status e por projeto</li>
                                <li>O detalhamento lista todas as visitas com data, n√∫mero, projeto e status</li>
                            </ul>
                        </div>

                        <!-- Bot√µes -->
                        <div class="d-grid gap-2 d-md-flex">
                            <button type="submit" class="btn btn-primary flex-grow-1">
                                <i class="fas fa-download me-2"></i>
                                Gerar Relat√≥rio
                            </button>
                            <a href="{{ url_for('visits_list') }}" class="btn btn-secondary">
                                Voltar
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Exemplos de uso -->
            <div class="card mt-4 bg-light">
                <div class="card-body">
                    <h6 class="card-title fw-semibold">üí° Como usar</h6>
                    <ol class="mb-0 small">
                        <li>Selecione o usu√°rio para o qual deseja gerar o relat√≥rio</li>
                        <li>Escolha o m√™s e ano do per√≠odo de an√°lise</li>
                        <li>Selecione o formato desejado (PDF para impress√£o, Excel para an√°lise)</li>
                        <li>Clique em "Gerar Relat√≥rio" para fazer o download</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
