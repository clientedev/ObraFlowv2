{% extends "base.html" %}

{% block title %}Como Instalar o App ELP - Guia Completo{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h2 class="mb-0">
                        <i class="fas fa-mobile-alt me-2"></i>
                        Como Instalar o App ELP no seu Dispositivo
                    </h2>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>App Nativo para Android e iOS!</strong><br>
                        O ELP Relatórios pode ser instalado como um aplicativo nativo no seu dispositivo, 
                        funcionando offline e com acesso direto da tela inicial.
                    </div>
                    
                    <!-- Botões de Instalação por Sistema Operacional -->
                    <div class="row mb-5" id="os-specific-install">
                        <div class="col-12">
                            <h3 class="text-center mb-4">
                                <i class="fas fa-download me-2"></i>
                                Instalar para o seu Sistema
                            </h3>
                        </div>
                        
                        <!-- Android -->
                        <div class="col-md-4 mb-3">
                            <div class="card border-success h-100" id="android-card" style="display: none;">
                                <div class="card-body text-center">
                                    <i class="fab fa-android text-success" style="font-size: 3rem;"></i>
                                    <h5 class="card-title mt-3">Android</h5>
                                    <p class="card-text">Instale via Chrome ou Firefox</p>
                                    <button class="btn btn-success" onclick="window.pwaInstaller.installApp()">
                                        <i class="fab fa-google-play me-2"></i>
                                        Instalar Agora
                                    </button>
                                    <button class="btn btn-outline-success btn-sm mt-2" onclick="window.pwaInstaller.showAndroidInstructions()">
                                        <i class="fas fa-info-circle me-2"></i>
                                        Ver Instruções
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- iOS -->
                        <div class="col-md-4 mb-3">
                            <div class="card border-primary h-100" id="ios-card" style="display: none;">
                                <div class="card-body text-center">
                                    <i class="fab fa-apple text-primary" style="font-size: 3rem;"></i>
                                    <h5 class="card-title mt-3">iPhone/iPad</h5>
                                    <p class="card-text">Adicionar à Tela Inicial via Safari</p>
                                    <button class="btn btn-primary" onclick="window.pwaInstaller.showIosInstructions()">
                                        <i class="fas fa-share me-2"></i>
                                        Como Instalar
                                    </button>
                                    <div class="mt-2">
                                        <small class="text-muted">Funciona apenas no Safari</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Desktop -->
                        <div class="col-md-4 mb-3">
                            <div class="card border-info h-100" id="desktop-card" style="display: none;">
                                <div class="card-body text-center">
                                    <i class="fas fa-desktop text-info" style="font-size: 3rem;"></i>
                                    <h5 class="card-title mt-3" id="desktop-title">Desktop</h5>
                                    <p class="card-text">Instale como programa no computador</p>
                                    <button class="btn btn-info" onclick="window.pwaInstaller.installApp()">
                                        <i class="fas fa-download me-2"></i>
                                        Instalar Agora
                                    </button>
                                    <button class="btn btn-outline-info btn-sm mt-2" onclick="window.pwaInstaller.showDesktopInstructions()">
                                        <i class="fas fa-info-circle me-2"></i>
                                        Ver Instruções
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <script>
                    // Detectar sistema operacional e mostrar cards relevantes
                    document.addEventListener('DOMContentLoaded', function() {
                        const userAgent = navigator.userAgent.toLowerCase();
                        const androidCard = document.getElementById('android-card');
                        const iosCard = document.getElementById('ios-card');
                        const desktopCard = document.getElementById('desktop-card');
                        const desktopTitle = document.getElementById('desktop-title');
                        
                        if (userAgent.includes('android')) {
                            androidCard.style.display = 'block';
                            desktopCard.style.display = 'block';
                            desktopTitle.textContent = 'Desktop/Computador';
                        } else if (userAgent.includes('iphone') || userAgent.includes('ipad')) {
                            iosCard.style.display = 'block';
                            desktopCard.style.display = 'block';
                            desktopTitle.textContent = 'Desktop/Computador';
                        } else if (userAgent.includes('windows')) {
                            desktopCard.style.display = 'block';
                            desktopTitle.innerHTML = '<i class="fab fa-windows me-2"></i>Windows';
                            androidCard.style.display = 'block';
                            iosCard.style.display = 'block';
                        } else if (userAgent.includes('mac')) {
                            desktopCard.style.display = 'block';
                            desktopTitle.innerHTML = '<i class="fab fa-apple me-2"></i>macOS';
                            androidCard.style.display = 'block';
                            iosCard.style.display = 'block';
                        } else if (userAgent.includes('linux')) {
                            desktopCard.style.display = 'block';
                            desktopTitle.innerHTML = '<i class="fab fa-linux me-2"></i>Linux';
                            androidCard.style.display = 'block';
                            iosCard.style.display = 'block';
                        } else {
                            // Mostrar todos se não conseguir detectar
                            androidCard.style.display = 'block';
                            iosCard.style.display = 'block';
                            desktopCard.style.display = 'block';
                        }
                    });
                    </script>
                    
                    <!-- Instruções para Android -->
                    <div class="mb-5">
                        <h3 class="text-success">
                            <i class="fab fa-android me-2"></i>
                            Android (Chrome/Firefox)
                        </h3>
                        <div class="row">
                            <div class="col-md-6">
                                <ol class="list-group list-group-numbered">
                                    <li class="list-group-item">
                                        <strong>Abra este site no Chrome ou Firefox</strong>
                                        <br><small class="text-muted">Certifique-se de estar usando um navegador compatível</small>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>Toque no menu (⋮) do navegador</strong>
                                        <br><small class="text-muted">Localizado no canto superior direito</small>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>Selecione "Instalar app" ou "Adicionar à tela inicial"</strong>
                                        <br><small class="text-muted">A opção pode variar conforme o navegador</small>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>Confirme a instalação</strong>
                                        <br><small class="text-muted">O app aparecerá na sua tela inicial</small>
                                    </li>
                                </ol>
                            </div>
                            <div class="col-md-6">
                                <div class="alert alert-success">
                                    <h6><i class="fas fa-check-circle me-2"></i>Recursos do App Android:</h6>
                                    <ul class="mb-0">
                                        <li>Funciona offline</li>
                                        <li>Acesso direto da tela inicial</li>
                                        <li>Interface em tela cheia</li>
                                        <li>Sincronização automática</li>
                                        <li>Notificações push (futuro)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Instruções para iOS -->
                    <div class="mb-5">
                        <h3 class="text-primary">
                            <i class="fab fa-apple me-2"></i>
                            iOS (Safari)
                        </h3>
                        <div class="row">
                            <div class="col-md-6">
                                <ol class="list-group list-group-numbered">
                                    <li class="list-group-item">
                                        <strong>Abra este site no Safari</strong>
                                        <br><small class="text-muted">⚠️ IMPORTANTE: Funciona APENAS no Safari! Chrome/Firefox do iOS não suportam PWA</small>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>Toque no botão de compartilhar (📤)</strong>
                                        <br><small class="text-muted">Localizado na parte inferior da tela (barra de ferramentas do Safari)</small>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>Role para baixo e toque em "Adicionar à Tela de Início"</strong>
                                        <br><small class="text-muted">Procure pelo ícone com um "+". Se não aparecer, recarregue a página</small>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>Confirme tocando em "Adicionar"</strong>
                                        <br><small class="text-muted">O app "ELP Relatórios" aparecerá na sua tela inicial</small>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>Ative as notificações quando solicitado</strong>
                                        <br><small class="text-muted">Para receber alertas de obras próximas e novidades</small>
                                    </li>
                                </ol>
                            </div>
                            <div class="col-md-6">
                                <div class="alert alert-info">
                                    <h6><i class="fas fa-info-circle me-2"></i>Recursos do App iOS:</h6>
                                    <ul class="mb-0">
                                        <li>Interface nativa iOS</li>
                                        <li>Funciona offline</li>
                                        <li>Acesso direto da tela inicial</li>
                                        <li>Integração com o sistema</li>
                                        <li>Sincronização em background</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Instruções para Desktop -->
                    <div class="mb-5">
                        <h3 class="text-info">
                            <i class="fas fa-desktop me-2"></i>
                            Desktop (Windows/Mac/Linux)
                        </h3>
                        <div class="row">
                            <div class="col-md-6">
                                <ol class="list-group list-group-numbered">
                                    <li class="list-group-item">
                                        <strong>Abra este site no Chrome, Edge ou Firefox</strong>
                                        <br><small class="text-muted">Navegadores modernos suportam instalação PWA</small>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>Procure pelo ícone de instalação na barra de endereços</strong>
                                        <br><small class="text-muted">Geralmente um ícone de "+" ou de download</small>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>Clique em "Instalar ELP Relatórios"</strong>
                                        <br><small class="text-muted">Ou use o menu do navegador</small>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>Confirme a instalação</strong>
                                        <br><small class="text-muted">O app aparecerá como programa instalado</small>
                                    </li>
                                </ol>
                            </div>
                            <div class="col-md-6">
                                <div class="alert alert-warning">
                                    <h6><i class="fas fa-exclamation-triangle me-2"></i>Requisitos Desktop:</h6>
                                    <ul class="mb-0">
                                        <li>Navegador moderno (Chrome 73+, Edge 79+, Firefox 90+)</li>
                                        <li>Conexão HTTPS ativa</li>
                                        <li>Suporte a Service Workers</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Resolução de Problemas iOS -->
                    <div class="alert alert-warning mb-4">
                        <h6><i class="fas fa-exclamation-triangle me-2"></i>Problemas no iOS?</h6>
                        <p class="mb-2"><strong>Se não conseguir instalar:</strong></p>
                        <ul class="mb-2">
                            <li>Certifique-se de estar usando <strong>Safari</strong> (não Chrome/Firefox)</li>
                            <li>Verifique se está usando iOS 11.3+ </li>
                            <li>Limpe o cache do Safari: Configurações > Safari > Limpar Histórico</li>
                            <li>Recarregue a página e tente novamente</li>
                            <li>Se ainda não funcionar, acesse direto pelo Safari sem outros apps</li>
                        </ul>
                        <small class="text-muted">O iOS tem restrições específicas para PWAs que funcionam apenas no Safari nativo.</small>
                    </div>
                    
                    <!-- Benefícios -->
                    <div class="mb-4">
                        <h3 class="text-secondary">
                            <i class="fas fa-star me-2"></i>
                            Benefícios do App Instalado
                        </h3>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card h-100 border-success">
                                    <div class="card-body text-center">
                                        <i class="fas fa-wifi-slash text-success" style="font-size: 2rem;"></i>
                                        <h5 class="card-title mt-3">Funciona Offline</h5>
                                        <p class="card-text">Continue trabalhando mesmo sem internet. Os dados sincronizam automaticamente quando reconectar.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card h-100 border-primary">
                                    <div class="card-body text-center">
                                        <i class="fas fa-rocket text-primary" style="font-size: 2rem;"></i>
                                        <h5 class="card-title mt-3">Acesso Rápido</h5>
                                        <p class="card-text">Abra diretamente da tela inicial, sem precisar abrir o navegador primeiro.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card h-100 border-info">
                                    <div class="card-body text-center">
                                        <i class="fas fa-bell text-info" style="font-size: 2rem;"></i>
                                        <h5 class="card-title mt-3">Notificações Inteligentes</h5>
                                        <p class="card-text">Alertas quando próximo de obras e notificações de novidades no sistema.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Solução de Problemas -->
                    <div class="mb-4">
                        <h3 class="text-warning">
                            <i class="fas fa-wrench me-2"></i>
                            Solução de Problemas
                        </h3>
                        <div class="accordion" id="troubleshootAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#problem1">
                                        Não vejo a opção "Instalar app"
                                    </button>
                                </h2>
                                <div id="problem1" class="accordion-collapse collapse" data-bs-parent="#troubleshootAccordion">
                                    <div class="accordion-body">
                                        <ul>
                                            <li>Certifique-se de estar usando um navegador compatível</li>
                                            <li>Verifique se está acessando via HTTPS</li>
                                            <li>Tente recarregar a página</li>
                                            <li>Limpe o cache do navegador</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#problem2">
                                        O app não funciona offline
                                    </button>
                                </h2>
                                <div id="problem2" class="accordion-collapse collapse" data-bs-parent="#troubleshootAccordion">
                                    <div class="accordion-body">
                                        <ul>
                                            <li>Aguarde o download completo na primeira instalação</li>
                                            <li>Verifique se o Service Worker está ativo</li>
                                            <li>Acesse as principais páginas uma vez online</li>
                                            <li>Reinicie o app se necessário</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#problem3">
                                        Como desinstalar o app
                                    </button>
                                </h2>
                                <div id="problem3" class="accordion-collapse collapse" data-bs-parent="#troubleshootAccordion">
                                    <div class="accordion-body">
                                        <strong>Android:</strong> Mantenha pressionado o ícone do app → "Desinstalar"<br>
                                        <strong>iOS:</strong> Mantenha pressionado o ícone do app → "Remover App"<br>
                                        <strong>Desktop:</strong> Configurações do navegador → Apps instalados → Desinstalar
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Botões de Ação -->
                    <div class="text-center">
                        <a href="{{ url_for('index') }}" class="btn btn-primary btn-lg me-3">
                            <i class="fas fa-home me-2"></i>
                            Voltar ao App
                        </a>
                        <button class="btn btn-success btn-lg" onclick="window.pwaInstaller?.installApp()" id="install-button">
                            <i class="fas fa-download me-2"></i>
                            Instalar Agora
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Verificar se PWA installer está disponível
document.addEventListener('DOMContentLoaded', () => {
    const installButton = document.getElementById('install-button');
    
    if (!window.pwaInstaller || !window.pwaInstaller.canShowInstallPrompt()) {
        installButton.disabled = true;
        installButton.innerHTML = '<i class="fas fa-check me-2"></i>App já instalado ou não disponível';
        installButton.className = 'btn btn-secondary btn-lg';
    }
});
</script>
{% endblock %}