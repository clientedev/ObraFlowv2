Implementa√ß√£o Completa do Item 34 (E-mails de envio de relat√≥rios por usu√°rio)

Preciso que voc√™ implemente o Item 34 ‚Äì E-mails de envio de relat√≥rios no meu sistema, garantindo que tudo esteja funcional, integrado ao PostgreSQL (Railway) e com tela de gerenciamento no painel admin.

üéØ Requisitos funcionais:

Banco de Dados (Alembic Migration):

Criar tabela user_email_config com os campos:

id (PK)

user_id (FK ‚Üí users.id, ON DELETE CASCADE, UNIQUE)

smtp_server (VARCHAR, obrigat√≥rio)

smtp_port (INTEGER, obrigat√≥rio)

email_address (VARCHAR, obrigat√≥rio)

email_password (VARCHAR, armazenado criptografado ou base64)

use_tls (BOOLEAN, default=True)

use_ssl (BOOLEAN, default=False)

created_at e updated_at

Garantir que o Alembic gere a migration correta e que seja aplicada no Railway sem erro.

Envio de relat√≥rios:

Quando um relat√≥rio for preenchido, deve ser enviado pelo e-mail configurado do usu√°rio que preencheu.

Quando for aprovado, deve ser enviado pelo e-mail configurado do aprovador.

Sempre enviar c√≥pia autom√°tica (CC) para o outro usu√°rio envolvido (exemplo: se enviado pelo preenchedor, copia o aprovador, e vice-versa).

Se o usu√°rio n√£o tiver configura√ß√£o pr√≥pria ‚Üí usar o e-mail padr√£o do sistema (configuracao_email).

Interface de Administra√ß√£o:

Criar uma tela acess√≠vel apenas a administradores no painel de administra√ß√£o:

Listar usu√°rios e suas configura√ß√µes de e-mail.

Permitir adicionar/editar/excluir configura√ß√£o de e-mail de cada usu√°rio.

Campos obrigat√≥rios: Servidor SMTP, Porta, E-mail, Senha, TLS/SSL.

Validar se o e-mail funciona antes de salvar (teste de conex√£o SMTP r√°pido).

Integra√ß√£o Backend:

No envio de relat√≥rios, buscar a configura√ß√£o do usu√°rio em user_email_config.

Caso exista, utilizar essas credenciais SMTP.

Caso n√£o exista, fallback para configuracao_email.

Registrar em log_envio_emails qual conta foi usada para o envio.

Restri√ß√µes:

Apenas administradores podem visualizar/editar configura√ß√µes de e-mail de usu√°rios.

Usu√°rios comuns n√£o podem ver ou alterar essas configura√ß√µes.

‚úÖ Resultado esperado:

Relat√≥rios s√£o enviados dinamicamente pela conta do usu√°rio que preencheu/aprovou.

C√≥pia (CC) autom√°tica para o outro respons√°vel.

Tela de gerenciamento completa no painel admin para configurar e-mails por usu√°rio.

Fallback garantido para o e-mail padr√£o.

Logs atualizados mostrando a conta usada no envio.