Corrigir solicita√ß√£o conjunta de Notifica√ß√£o + Localiza√ß√£o

Implemente a seguinte modifica√ß√£o no sistema:

üîπ Problema: Atualmente, ao clicar em "Ativar Notifica√ß√µes", o sistema pede somente permiss√£o de notifica√ß√µes (Notification).
üîπ Objetivo: Sempre que o usu√°rio clicar em Ativar Notifica√ß√µes, o sistema deve pedir as duas permiss√µes:

Permiss√£o de Notifica√ß√µes (Push)

Permiss√£o de Localiza√ß√£o (Geolocation)

üîπ Solu√ß√£o no Frontend (JavaScript):

async function ativarNotificacoes() {
    try {
        // 1. Solicitar permiss√£o para notifica√ß√µes
        const notifPerm = await Notification.requestPermission();

        if (notifPerm !== "granted") {
            alert("√â necess√°rio permitir notifica√ß√µes para continuar.");
            return;
        }

        // 2. Solicitar permiss√£o para localiza√ß√£o
        navigator.geolocation.getCurrentPosition(
            (position) => {
                console.log("Localiza√ß√£o autorizada:", position.coords);
                registrarPermissoes(position.coords); 
            },
            (error) => {
                console.error("Erro ao obter localiza√ß√£o:", error);
                alert("√â necess√°rio permitir a localiza√ß√£o para ativar as notifica√ß√µes.");
            },
            { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
        );

    } catch (err) {
        console.error("Erro ao ativar notifica√ß√µes e localiza√ß√£o:", err);
        alert("Ocorreu um erro. Tente novamente.");
    }
}

function registrarPermissoes(coords) {
    fetch("/api/user/permissions", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": document.querySelector("meta[name='csrf-token']").content
        },
        body: JSON.stringify({
            notifications: true,
            location: {
                lat: coords.latitude,
                lng: coords.longitude
            }
        })
    }).then(resp => {
        if (resp.ok) {
            console.log("Permiss√µes registradas com sucesso.");
        } else {
            console.error("Falha ao registrar permiss√µes.");
        }
    });
}


üîπ Regras adicionais:

O fluxo s√≥ deve ser considerado ativo se as duas permiss√µes forem concedidas.

Se o usu√°rio negar qualquer uma, exibir mensagem clara ‚ÄúPara usar as notifica√ß√µes, √© obrigat√≥rio tamb√©m permitir a localiza√ß√£o‚Äù.

O backend deve salvar no banco que ambas permiss√µes foram concedidas antes de habilitar notifica√ß√µes de proximidade.

‚úÖ Resultado esperado:

Ao clicar em Ativar Notifica√ß√µes, o navegador pedir√° dois di√°logos: Notifica√ß√µes e Localiza√ß√£o.

Se a localiza√ß√£o for negada, as notifica√ß√µes n√£o s√£o ativadas.

Garante que o sistema s√≥ funcione se o usu√°rio conceder ambas as permiss√µes.