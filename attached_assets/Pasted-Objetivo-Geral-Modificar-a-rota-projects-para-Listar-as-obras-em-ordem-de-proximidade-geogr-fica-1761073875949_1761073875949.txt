Objetivo Geral

Modificar a rota /projects para:

Listar as obras em ordem de proximidade geogr√°fica (como no dashboard).

Priorizar obras ativas antes das conclu√≠das.

Simplificar a interface:

O card inteiro da obra se torna o bot√£o ‚Äúver‚Äù.

O bot√£o ‚Äúeditar‚Äù s√≥ aparece dentro da visualiza√ß√£o da obra, e apenas para o usu√°rio master.

‚öôÔ∏è 1Ô∏è‚É£ Backend ‚Äì Rota /projects
Altera√ß√£o da l√≥gica de listagem

Reutilizar ou importar a mesma fun√ß√£o usada no Dashboard para calcular a dist√¢ncia entre a localiza√ß√£o atual do usu√°rio e as coordenadas das obras (latitude, longitude).

Exemplo gen√©rico (ajuste conforme o nome usado em seu projeto):

from geopy.distance import geodesic

@app.route("/projects")
@login_required
def project_list():
    user_location = get_user_location(current_user)  # Fun√ß√£o que obt√©m lat/lon do usu√°rio

    projects = Project.query.all()

    projetos_com_distancia = []
    for project in projects:
        if project.latitude and project.longitude:
            distancia = geodesic(
                (user_location.lat, user_location.lon),
                (project.latitude, project.longitude)
            ).km
        else:
            distancia = float('inf')  # Obras sem localiza√ß√£o v√£o para o final
        projetos_com_distancia.append((project, distancia))

    # Ordena por status (ativos primeiro) e depois pela menor dist√¢ncia
    projetos_com_distancia.sort(
        key=lambda x: (
            0 if x[0].status == 'Ativo' else 1,
            x[1]
        )
    )

    # Extrai apenas os objetos ordenados
    ordered_projects = [p[0] for p in projetos_com_distancia]

    return render_template(
        "projects/list.html",
        projects=ordered_projects
    )


üß© Comportamento esperado:

Obras ativas aparecem no topo, ordenadas pela menor dist√¢ncia ao usu√°rio.

Obras conclu√≠das aparecem em seguida, tamb√©m ordenadas pela dist√¢ncia.

üß± 2Ô∏è‚É£ Frontend ‚Äì Template projects/list.html
Remover bot√µes individuais e transformar o card em bot√£o clic√°vel
{% for project in projects %}
<div class="project-card"
     onclick="window.location.href='{{ url_for('project_view', id=project.id) }}'">
    <div class="project-header">
        <span class="project-code">{{ project.codigo }}</span>
        <span class="status {{ 'ativo' if project.status == 'Ativo' else 'concluido' }}">
            {{ project.status }}
        </span>
    </div>
    <div class="project-body">
        <h4>{{ project.nome }}</h4>
        <p>{{ project.empresa }}</p>
    </div>
</div>
{% endfor %}

CSS de apoio
.project-card {
    background: #fff;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 12px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.1s ease;
}
.project-card:hover {
    background-color: #f3f6fa;
    transform: translateY(-2px);
}
.status.ativo {
    color: #198754;
    font-weight: 600;
}
.status.concluido {
    color: #6c757d;
}

üîê 3Ô∏è‚É£ Controle de Acesso ‚Äì Edi√ß√£o de Obras

Na rota de visualiza√ß√£o (/projects/<id>):

{% if current_user.role == 'master' %}
  <a href="{{ url_for('project_edit', id=project.id) }}" class="btn btn-primary">
      Editar Obra
  </a>
{% endif %}


E refor√ßar a prote√ß√£o no backend:

@app.route("/projects/<int:id>/edit")
@login_required
def project_edit(id):
    project = Project.query.get_or_404(id)
    if current_user.role != 'master':
        flash("Apenas o usu√°rio master pode editar obras.", "danger")
        return redirect(url_for('project_view', id=id))
    return render_template("projects/form.html", project=project)

üîí 4Ô∏è‚É£ Controle do bot√£o ‚Äú+ Nova Obra‚Äù

Somente o usu√°rio master deve ver o bot√£o:

{% if current_user.role == 'master' %}
  <a href="{{ url_for('project_new') }}" class="btn btn-primary mb-3">
      + Nova Obra
  </a>
{% endif %}

‚úÖ 5Ô∏è‚É£ Testes esperados
Cen√°rio	Resultado Esperado
Usu√°rio acessa /projects	Obras aparecem ordenadas por proximidade e status ativo primeiro
Card clicado	Redireciona para /projects/<id>
Usu√°rio comum	N√£o v√™ bot√£o ‚Äúeditar‚Äù
Usu√°rio master	V√™ bot√£o ‚ÄúEditar Obra‚Äù dentro da visualiza√ß√£o
Obras sem localiza√ß√£o	S√£o listadas por √∫ltimo
Dashboard e lista de obras	Mostram a mesma l√≥gica de proximidade
üßæ Resumo t√©cnico
- Rota /projects: Ordenar por status + proximidade geogr√°fica (como no dashboard)
- Remover bot√µes individuais ‚Äúver‚Äù e ‚Äúeditar‚Äù na listagem
- Tornar card clic√°vel para visualizar obra
- Exibir bot√£o ‚ÄúEditar Obra‚Äù apenas dentro da visualiza√ß√£o, e s√≥ para usu√°rio master
- Reutilizar fun√ß√£o existente do dashboard para c√°lculo de dist√¢ncia