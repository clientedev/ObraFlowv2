Corre√ß√£o SMTP e Aprova√ß√£o de Relat√≥rio

Este prompt redefine apenas o envio de e-mail durante a aprova√ß√£o do relat√≥rio, corrigindo o erro de WORKER TIMEOUT e garantindo que, mesmo em falha de conex√£o SMTP, o sistema continue funcionando e registrando logs detalhados.

üß† Prompt:

Identifique e corrija a causa raiz do erro ‚ÄúWORKER TIMEOUT‚Äù e ‚Äúsmtplib.SMTP() timeout‚Äù que ocorre ao aprovar relat√≥rios.  
Atualmente, o sistema tenta enviar e-mails via Flask-Mail e trava porque o servidor SMTP n√£o responde, causando falha no Gunicorn.  

Implemente as seguintes melhorias no sistema, sem alterar outras funcionalidades:

1Ô∏è‚É£ No arquivo `config.py`, configure corretamente o SMTP com suporte SSL, evitando bloqueios:
   MAIL_SERVER = 'smtp.hostinger.com'
   MAIL_PORT = 465
   MAIL_USE_SSL = True
   MAIL_USE_TLS = False
   MAIL_USERNAME = os.getenv('SMTP_USER')
   MAIL_PASSWORD = os.getenv('SMTP_PASS')
   MAIL_DEFAULT_SENDER = ('ELP Consultoria', MAIL_USERNAME)
   MAIL_DEBUG = True

2Ô∏è‚É£ No arquivo `email_service.py`, modifique a fun√ß√£o respons√°vel por enviar e-mails (`enviar_relatorio_por_email`) para:
   - Adicionar timeout seguro de 10 segundos na conex√£o SMTP:
     ```python
     import smtplib
     smtplib.socket.setdefaulttimeout(10)
     ```
   - Usar try/except robusto para capturar falhas de rede, autentica√ß√£o ou SSL:
     ```python
     try:
         with self.mail.connect() as conn:
             conn.send(msg)
             app.logger.info("üìß Email enviado com sucesso para todos os destinat√°rios.")
     except smtplib.SMTPConnectError as e:
         app.logger.error(f"‚ùå Falha na conex√£o SMTP: {e}")
     except smtplib.SMTPAuthenticationError as e:
         app.logger.error(f"‚ùå Erro de autentica√ß√£o SMTP: {e}")
     except smtplib.SMTPException as e:
         app.logger.error(f"‚ö†Ô∏è Erro gen√©rico de envio SMTP: {e}")
     except Exception as e:
         app.logger.error(f"üí• Erro inesperado ao enviar e-mail: {str(e)}")
     finally:
         app.logger.info("‚úÖ Processo de aprova√ß√£o conclu√≠do ‚Äî mesmo em caso de falha de envio.")
     ```

3Ô∏è‚É£ No endpoint `/reports/<int:id>/approve`, adicione tratamento de exce√ß√µes para que a aprova√ß√£o do relat√≥rio **n√£o dependa do sucesso do e-mail**:
   ```python
   try:
       resultado = email_service_relatorio.enviar_relatorio_por_email(...)
   except Exception as e:
       app.logger.warning(f"‚ö†Ô∏è Relat√≥rio aprovado, mas falha ao enviar e-mail: {e}")


4Ô∏è‚É£ Adicione um log para confirmar que o worker n√£o travou:

app.logger.info(f"üü¢ Relat√≥rio {report_id} aprovado e processo finalizado com sucesso.")


5Ô∏è‚É£ Teste com as vari√°veis de ambiente:
SMTP_USER="relatorios@elpconsultoria.eng.br
"
SMTP_PASS="ugZ32b9ayCgu5uK="

Objetivo final:

Evitar travamentos (WORKER TIMEOUT).

Permitir aprova√ß√£o de relat√≥rios mesmo se o envio de e-mail falhar.

Garantir logs informativos no console (INFO, ERROR, WARNING).

Manter o envio de anexos (PDF do relat√≥rio) e mensagem no formato correto.

üí° Resultado esperado:
Ap√≥s aplicar, ao aprovar um relat√≥rio:

O sistema deve registrar ‚Äúüìß Email enviado com sucesso...‚Äù ou ‚Äú‚ö†Ô∏è Falha ao enviar e-mail...‚Äù,

E o relat√≥rio deve ser aprovado corretamente, sem travar ou duplicar workers.