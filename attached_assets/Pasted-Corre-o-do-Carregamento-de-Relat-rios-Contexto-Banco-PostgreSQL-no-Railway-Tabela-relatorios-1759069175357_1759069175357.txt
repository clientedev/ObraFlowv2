Corre√ß√£o do Carregamento de Relat√≥rios

Contexto:

Banco: PostgreSQL no Railway.

Tabela: relatorios j√° cont√©m dados v√°lidos.

Problema: A tela exibe ‚ÄúSistema em modo de recupera√ß√£o‚Äù e n√£o carrega relat√≥rios, mesmo existindo registros no banco.

Situa√ß√£o: Isso ocorre ap√≥s as √∫ltimas altera√ß√µes e migrations.

üõ†Ô∏è O que revisar e corrigir

Modelos SQLAlchemy

Conferir se o modelo Relatorio (classe em models.py) est√° alinhado com a tabela relatorios no banco.

Garantir que todos os campos obrigat√≥rios (id, numero, projeto_id, autor_id, created_at, etc.) est√£o corretamente mapeados.

Validar se os novos campos adicionados em migrations (ex.: numero_projeto) est√£o presentes no modelo.

Migrations Alembic

Conferir se todas as migrations foram aplicadas corretamente no Railway.

Se necess√°rio, rodar:

alembic upgrade head


Garantir que n√£o existe diverg√™ncia entre alembic_version e as tabelas reais.

Se houver conflito, criar nova migration de ajuste ao inv√©s de recriar tabelas.

Query de listagem de relat√≥rios

Revisar a rota /relatorios ou equivalente no routes.py.

Validar se a query est√° filtrando incorretamente (status, finalizado, etc.) e retornando vazio.

Implementar logs para mostrar o SQL gerado e a quantidade de registros retornados.

Exemplo:

relatorios = Relatorio.query.all()
app.logger.info(f"Relat√≥rios encontrados: {len(relatorios)}")


Sistema de recupera√ß√£o

O modo de recupera√ß√£o s√≥ deve ser acionado em caso de erro grave (ex.: tabela n√£o encontrada).

Ajustar para exibir logs detalhados em produ√ß√£o Railway, permitindo identificar se √© erro de conex√£o, mapping ou migra√ß√£o.

Teste com dados reais

Rodar SELECT * FROM relatorios LIMIT 5; no PostgreSQL Railway para confirmar que os registros existem.

Garantir que a aplica√ß√£o exibe esses registros corretamente na interface.

‚úÖ Resultado esperado

A rota /relatorios carrega normalmente todos os relat√≥rios j√° existentes no banco.

O erro ‚ÄúSistema em modo de recupera√ß√£o‚Äù desaparece.

Logs no Railway mostram corretamente a contagem de relat√≥rios carregados.

Migrations ficam sincronizadas entre c√≥digo Alembic e o banco real do Railway.