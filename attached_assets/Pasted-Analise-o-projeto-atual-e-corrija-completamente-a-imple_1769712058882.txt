Analise o projeto atual e corrija completamente a implementa√ß√£o de Push Notifications para um PWA, garantindo que:

As vari√°veis de ambiente estejam corretas

Cada vari√°vel seja usada no local certo (frontend vs backend)

N√£o exista vazamento de credenciais sens√≠veis

üéØ Objetivo final

Ter um PWA com Push Notifications funcionando como app nativo, usando Firebase Cloud Messaging (FCM), com backend rodando em Node.js (deploy no Railway).

üîµ FRONTEND (PWA)

Corrigir e padronizar o uso das seguintes vari√°veis de ambiente no frontend:

FIREBASE_API_KEY
FIREBASE_AUTH_DOMAIN
FIREBASE_PROJECT_ID
FIREBASE_STORAGE_BUCKET
FIREBASE_MESSAGING_SENDER_ID
FIREBASE_APP_ID
FIREBASE_VAPID_KEY

Regras do frontend:

Usar essas vari√°veis para inicializar o Firebase Web SDK

Registrar corretamente o Service Worker

Solicitar permiss√£o de notifica√ß√£o apenas ap√≥s a√ß√£o do usu√°rio

Gerar o token FCM usando a FIREBASE_VAPID_KEY

Enviar o token para o backend via API

üî¥ BACKEND (Node.js ‚Äì Railway)

Ajustar o backend para N√ÉO usar vari√°veis de frontend.

O backend deve usar exclusivamente:

FIREBASE_PROJECT_ID
FIREBASE_CLIENT_EMAIL
FIREBASE_PRIVATE_KEY

Regras do backend:

Inicializar o Firebase Admin SDK corretamente

Converter \\n da FIREBASE_PRIVATE_KEY em quebras reais de linha

Criar endpoint para envio de notifica√ß√µes (ex: POST /notifications/send)

Enviar notifica√ß√µes via Firebase Cloud Messaging

Tratar tokens inv√°lidos ou expirados

üö´ Limpezas obrigat√≥rias

Remover qualquer uso de FIREBASE_CONFIG

N√£o usar API_KEY, APP_ID ou VAPID_KEY no backend

Garantir que nenhuma chave sens√≠vel seja exposta no frontend

üîî Service Worker

Criar ou corrigir firebase-messaging-sw.js

Implementar os eventos:

push

notificationclick

Garantir que o clique na notifica√ß√£o abra ou foque o PWA

üì¶ Entreg√°veis esperados

C√≥digo corrigido e funcional

Separa√ß√£o clara entre frontend e backend

Uso correto das vari√°veis de ambiente

Push Notifications funcionando em:

Android

Desktop

iOS (iOS 16.4+, app instalado)

O resultado deve ser uma implementa√ß√£o pronta para produ√ß√£o, compat√≠vel com Railway, sem vari√°veis redundantes ou inseguras.