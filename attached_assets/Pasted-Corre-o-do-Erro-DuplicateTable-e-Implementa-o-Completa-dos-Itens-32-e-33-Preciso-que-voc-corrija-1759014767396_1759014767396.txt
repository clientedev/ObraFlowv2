Corre√ß√£o do Erro DuplicateTable e Implementa√ß√£o Completa dos Itens 32 e 33

Preciso que voc√™ corrija imediatamente o problema de DuplicateTable ao rodar as migrations no Railway. O erro ocorre porque a tabela relatorio_express_participantes j√° existe no banco, mas o Alembic insiste em recri√°-la.

üëâ O que precisa ser feito:

Corrigir a migration atual (20250927_2241_add_relatorio_express_participantes.py) para que:

Antes de criar a tabela, verifique se ela j√° existe:

from sqlalchemy import inspect

def upgrade():
    bind = op.get_bind()
    inspector = inspect(bind)
    if 'relatorio_express_participantes' not in inspector.get_table_names():
        op.create_table(
            'relatorio_express_participantes',
            sa.Column('id', sa.Integer, primary_key=True),
            sa.Column('relatorio_express_id', sa.Integer, sa.ForeignKey('relatorios_express.id', ondelete="CASCADE"), nullable=False),
            sa.Column('funcionario_id', sa.Integer, sa.ForeignKey('users.id', ondelete="CASCADE"), nullable=False),
            sa.Column('created_at', sa.TIMESTAMP, server_default=sa.func.now())
        )


Isso evita recriar tabelas que j√° existem.

Sincronizar Alembic com o banco de dados no Railway:

Se a tabela j√° existe mas o Alembic n√£o registrou a migration, execute:

alembic stamp head


Isso marcar√° a vers√£o atual como aplicada sem recriar nada.

Refor√ßar as funcionalidades dos Itens 32 e 33:

Item 32: O campo endereco_visita j√° existe na tabela relatorios_express. Corrigir para que ele seja preenchido corretamente quando a geolocaliza√ß√£o for capturada e exibido no relat√≥rio express + PDF.

Item 33: Relat√≥rio express deve ter os mesmos campos do relat√≥rio de obra, mas edit√°veis manualmente (Data, Nome, Construtora, Endere√ßo, Funcion√°rios, E-mails).

Funcion√°rios devem ser vinculados via relatorio_express_participantes.

No PDF, devem aparecer somente os nomes dos funcion√°rios (os e-mails ficam apenas para envio).

Deploy no Railway

Garanta que ap√≥s essa corre√ß√£o o sistema rode sem DuplicateTable.

Teste todas as rotas de relat√≥rios express: cria√ß√£o, edi√ß√£o, listagem, visualiza√ß√£o e gera√ß√£o de PDF.

Confirme que a integra√ß√£o com o banco PostgreSQL do Railway funciona corretamente.

‚úÖ Resumo do que deve ser entregue:

Migration corrigida para n√£o recriar tabela existente.

Alembic sincronizado com o banco (alembic stamp head se necess√°rio).

Corre√ß√£o do endereco_visita no relat√≥rio express.

Implementa√ß√£o da sele√ß√£o e exibi√ß√£o de funcion√°rios no relat√≥rio express.

PDF mostrando somente os nomes dos funcion√°rios.