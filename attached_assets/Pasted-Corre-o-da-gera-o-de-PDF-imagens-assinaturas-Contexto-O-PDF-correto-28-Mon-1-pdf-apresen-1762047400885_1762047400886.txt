Corre√ß√£o da gera√ß√£o de PDF (imagens + assinaturas)

Contexto:
O PDF correto (28_Mon_(1).pdf) apresenta o layout desejado, por√©m atualmente o sistema:

Oculta as duas primeiras imagens;

Quebra o layout ao exibir mais de 3 imagens;

Exibe as imagens fora de ordem e distorcidas;

Mistura a √°rea de assinaturas com as imagens ou corta a se√ß√£o final;

Exibe inconsist√™ncia de pagina√ß√£o e alinhamento.

üéØ Objetivo

Corrigir completamente o comportamento da gera√ß√£o de PDF garantindo que:

As duas primeiras imagens apare√ßam corretamente na primeira p√°gina.

A partir da 3¬™ imagem, as imagens sejam organizadas em grupos de at√© 4 por p√°gina (2x2 grid).

As imagens mantenham propor√ß√£o (object-fit: contain) e n√£o distor√ßam.

As legendas (‚ÄúFoto X - descri√ß√£o‚Äù) apare√ßam logo abaixo de cada imagem.

Nenhum campo do relat√≥rio seja alterado, apenas a renderiza√ß√£o das imagens e a posi√ß√£o das assinaturas.

A √°rea de assinaturas deve ser sempre a √∫ltima se√ß√£o do PDF, ap√≥s todas as imagens, exatamente como no primeiro PDF enviado.

Pagina√ß√£o ‚ÄúP√°gina X / Y‚Äù apare√ßa no canto inferior direito em todas as p√°ginas.

Layout e design geral do relat√≥rio devem permanecer inalterados.

üí° Solu√ß√£o recomendada (HTML + CSS do template PDF)
HTML (Jinja2 ou similar):
<section class="pdf-images">
  {# As duas primeiras imagens aparecem na primeira p√°gina #}
  {% for img in imagens[:2] %}
  <figure class="img-single">
    <img src="{{ img.url }}" alt="Foto {{ loop.index }}">
    <figcaption>Foto {{ loop.index }} - {{ img.legenda }}</figcaption>
  </figure>
  {% endfor %}

  {# As demais imagens s√£o organizadas 4 por p√°gina (2x2) #}
  {% set restantes = imagens[2:] %}
  {% for chunk in restantes|batch(4, fill_with=None) %}
  <div class="grid-page">
    {% for img in chunk %}
      {% if img %}
      <figure class="img-grid">
        <img src="{{ img.url }}" alt="Foto {{ loop.index0 + 3 }}">
        <figcaption>Foto {{ loop.index0 + 3 }} - {{ img.legenda }}</figcaption>
      </figure>
      {% endif %}
    {% endfor %}
  </div>
  {% endfor %}
</section>

{# Assinaturas devem aparecer sempre ap√≥s todas as imagens #}
<section class="assinaturas">
  <div class="assinatura-bloco">
    <p><strong>Respons√°vel T√©cnico:</strong> {{ responsavel }}</p>
    <p><strong>Data:</strong> {{ data_relatorio }}</p>
  </div>
  <div class="assinatura-bloco">
    <p><strong>Administrador:</strong> {{ administrador }}</p>
    <p><strong>Assinatura:</strong> ___________________________</p>
  </div>
</section>

CSS (para impress√£o / PDF):
/* Layout geral */
img { display: block; max-width: 100%; height: auto; }
figure { page-break-inside: avoid; margin: 0; padding: 0; }

/* PRIMEIRAS 2 IMAGENS */
.img-single {
  width: 100%;
  margin-bottom: 12px;
}
.img-single img {
  width: 100%;
  max-height: calc(50vh - 60px);
  object-fit: contain;
}
.img-single figcaption {
  font-size: 10px;
  text-align: left;
  margin-top: 6px;
  color: #333;
}

/* IMAGENS RESTANTES ‚Äî GRID 2x2 POR P√ÅGINA */
.grid-page {
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-auto-rows: auto;
  gap: 8px;
  margin-top: 10px;
  page-break-after: always;
}
.img-grid {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 6px;
  background: #fff;
}
.img-grid img {
  width: 100%;
  max-height: calc((297mm - 150px) / 2);
  object-fit: contain;
}
.img-grid figcaption {
  font-size: 10px;
  margin-top: 6px;
  color: #333;
}

/* SE√á√ÉO DE ASSINATURAS ‚Äî sempre no final */
.assinaturas {
  page-break-before: always;
  padding-top: 30px;
}
.assinatura-bloco {
  display: flex;
  flex-direction: column;
  margin-bottom: 20px;
  font-size: 12px;
}
.assinatura-bloco p {
  margin: 3px 0;
}

/* Pagina√ß√£o no rodap√© */
@page {
  @bottom-right {
    content: "P√°gina " counter(page) " / " counter(pages);
  }
}

üß© Configura√ß√£o no Backend (WeasyPrint / wkhtmltopdf)

Gerar HTML completo com todas as imagens antes da convers√£o.

Verifique se todas as src das imagens est√£o acess√≠veis (sem loading="lazy").

Preferir URLs absolutas ou base64 inline se houver autentica√ß√£o.

Executar convers√£o:

HTML(string=rendered_html, base_url=base_url).write_pdf(
    pdf_output_path,
    presentational_hints=True
)


Garantir que a se√ß√£o de assinaturas esteja fora de loops ou condicionais.

O template deve renderizar as imagens primeiro, depois a √°rea de assinatura, sem exce√ß√µes.

‚úÖ Checklist de Aceita√ß√£o

 As 2 primeiras imagens aparecem corretamente (sem oculta√ß√£o).

 A partir da 3¬™ imagem, s√£o exibidas at√© 4 por p√°gina (2x2).

 Nenhuma imagem distorce ou quebra o layout.

 Legendas associadas a cada imagem.

 A √°rea de assinaturas √© sempre a √∫ltima parte do relat√≥rio.

 Nenhum outro campo ou estilo do relat√≥rio foi modificado.

 Pagina√ß√£o ‚ÄúP√°gina X / Y‚Äù vis√≠vel em todas as p√°ginas.