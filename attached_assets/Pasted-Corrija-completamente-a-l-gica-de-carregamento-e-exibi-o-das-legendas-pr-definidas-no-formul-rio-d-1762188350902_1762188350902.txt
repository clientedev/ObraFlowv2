Corrija completamente a l√≥gica de carregamento e exibi√ß√£o das legendas pr√©-definidas no formul√°rio de edi√ß√£o de relat√≥rio (/reports/<id>/editarrel).

O backend j√° retorna corretamente as legendas pela rota:

GET /api/legendas?categoria=all


e o console mostra ‚úÖ DADOS OK: 42 legendas (sem mudan√ßas),
mas elas n√£o aparecem na lista de sele√ß√£o (<select> ou dropdown) ao editar.

‚öôÔ∏è Requisitos para a corre√ß√£o:
1Ô∏è‚É£ As legendas devem ser carregadas assim que a p√°gina for aberta.
2Ô∏è‚É£ Devem aparecer no campo ‚ÄúOu escolha uma legenda pr√©-definida‚Äù de cada imagem existente.
3Ô∏è‚É£ A legenda selecionada deve preencher automaticamente o campo de texto ‚ÄúLegenda *‚Äù.
4Ô∏è‚É£ Deve funcionar tanto na cria√ß√£o quanto na edi√ß√£o de relat√≥rios.
5Ô∏è‚É£ O carregamento deve ocorrer apenas uma vez e armazenar as legendas em cache (para n√£o refazer o GET a cada imagem).
6Ô∏è‚É£ Caso a API falhe, exibir uma mensagem de erro clara no console.

üß© FRONTEND ‚Äî Substituir o carregamento de legendas
// --- reports_legendas.js ---
// Corrige o carregamento e vincula√ß√£o das legendas pr√©-definidas

async function carregarLegendasPreDefinidas() {
  try {
    console.log("üì¶ Carregando legendas pr√©-definidas...");
    const response = await fetch("/api/legendas?categoria=all");
    if (!response.ok) throw new Error("Falha ao carregar legendas.");

    const data = await response.json();
    if (!Array.isArray(data) || data.length === 0) {
      console.warn("‚ö†Ô∏è Nenhuma legenda encontrada.");
      return [];
    }

    console.log(`‚úÖ ${data.length} legendas carregadas com sucesso.`);
    return data;
  } catch (error) {
    console.error("‚ùå Erro ao carregar legendas:", error);
    return [];
  }
}

// --- Preenche o dropdown de legendas em cada bloco de imagem ---
async function preencherDropdownLegendas() {
  const legendas = await carregarLegendasPreDefinidas();
  if (!legendas.length) return;

  document.querySelectorAll(".legenda-select").forEach(select => {
    // Limpa op√ß√µes antigas
    select.innerHTML = `<option value="">Ou escolha uma legenda pr√©-definida</option>`;
    // Preenche lista
    legendas.forEach(legenda => {
      const opt = document.createElement("option");
      opt.value = legenda.texto || legenda.nome || legenda.legenda;
      opt.textContent = legenda.texto || legenda.nome || legenda.legenda;
      select.appendChild(opt);
    });

    // Ao selecionar uma legenda, preencher o campo de texto automaticamente
    select.addEventListener("change", e => {
      const campoLegenda = select.closest(".photo-card").querySelector(".photo-caption");
      if (campoLegenda) campoLegenda.value = e.target.value;
      campoLegenda.classList.add("border-success");
    });
  });
}

// --- Chama assim que a tela de edi√ß√£o estiver pronta ---
document.addEventListener("DOMContentLoaded", () => {
  preencherDropdownLegendas();
});

‚úÖ HTML ‚Äî garantir a estrutura esperada

Cada bloco de imagem no template form_complete.html deve ter:

<div class="photo-card" data-photo-id="{{ imagem.id }}">
  <label>Legenda *</label>
  <input type="text" class="form-control photo-caption" value="{{ imagem.legenda or '' }}">

  <select class="form-select legenda-select">
    <option value="">Ou escolha uma legenda pr√©-definida</option>
  </select>
</div>

üß© BACKEND ‚Äî garantir o formato esperado

A rota /api/legendas deve retornar um array simples, ex:

[
  {"id": 1, "texto": "Embo√ßo mal-acabado"},
  {"id": 2, "texto": "Lixamento executado sem preenchimento"},
  {"id": 3, "texto": "Pintura irregular"}
]


Se atualmente ela retorna algo como {"data": [...]}, ajuste o JS para data.data em vez de data.

üß† Diagn√≥stico e Garantias
Situa√ß√£o atual	Causa	Corre√ß√£o aplicada
‚úÖ API retorna legendas, mas dropdown vazio	Script n√£o popula os <select>	JS faz fetch e preenche todos
‚ö†Ô∏è Dropdown sem listener	Nenhum evento vinculado	select.addEventListener("change", ...) inclu√≠do
‚ö° API sendo chamada v√°rias vezes	Multiplica√ß√£o de chamadas por foto	Armazena em cache (carregarLegendasPreDefinidas() √© chamada uma vez)
üß± Legenda selecionada n√£o preenche input	Falta sincroniza√ß√£o de campos	Sincroniza√ß√£o autom√°tica adicionada