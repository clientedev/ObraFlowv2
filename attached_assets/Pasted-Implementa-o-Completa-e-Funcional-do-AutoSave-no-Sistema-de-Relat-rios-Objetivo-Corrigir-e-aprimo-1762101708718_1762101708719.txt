Implementa√ß√£o Completa e Funcional do AutoSave no Sistema de Relat√≥rios

Objetivo:
Corrigir e aprimorar a funcionalidade de salvamento autom√°tico (AutoSave) do m√≥dulo de relat√≥rios, garantindo que todas as informa√ß√µes preenchidas pelo usu√°rio ‚Äî incluindo textos, campos, checklist, observa√ß√µes, lembrete, acompanhantes e imagens ‚Äî sejam salvas em tempo real enquanto o usu√°rio preenche o relat√≥rio.
O salvamento deve ocorrer de forma incremental e segura, permitindo que o usu√°rio retome exatamente de onde parou em caso de sa√≠da inesperada, fechamento do navegador ou perda de conex√£o.

üß© Requisitos Funcionais

AutoSave Completo

Implementar um sistema de AutoSave baseado em eventos (input, change, blur, upload, etc.).

Toda altera√ß√£o nos campos deve acionar uma rotina ass√≠ncrona que salva o estado atual do relat√≥rio no backend via API REST.

Utilizar debounce (ex: 2 segundos) para evitar requisi√ß√µes excessivas.

Campos que Devem ser Salvos Automaticamente

Data do relat√≥rio

T√≠tulo do relat√≥rio

Projeto vinculado

N√∫mero do relat√≥rio

Acompanhantes (inclus√£o, exclus√£o e fun√ß√£o)

Checklist da obra (itens padr√£o e personalizados, com status e observa√ß√µes)

Observa√ß√µes gerais

Lembrete para pr√≥xima visita

Imagens (upload, exclus√£o, legenda, local, categoria)

Campos adicionais adicionados por Alembic (ex: descricao, observacoes_finais, lembrete_proxima_visita, categoria, local, checklist_data)

Imagens

As imagens devem ser salvas imediatamente ap√≥s upload, vinculadas ao ID do relat√≥rio.

Ao editar um relat√≥rio existente, as imagens j√° associadas devem ser carregadas automaticamente e exibidas na galeria com op√ß√µes de editar legenda/local/categoria ou excluir.

O AutoSave deve incluir tamb√©m novas imagens enviadas, garantindo sincroniza√ß√£o completa.

Persist√™ncia de Dados

Se o usu√°rio fechar o navegador ou perder a conex√£o, o relat√≥rio deve ser recuperado com todos os dados ao reabrir a tela.

Ao iniciar um novo relat√≥rio, o sistema deve criar automaticamente um rascunho (status: ‚Äúem preenchimento‚Äù) e continuar salvando altera√ß√µes nesse mesmo registro.

Se o relat√≥rio for conclu√≠do, o AutoSave deve ser desativado e o status atualizado para ‚Äúconclu√≠do‚Äù.

Feedback Visual

Exibir status de salvamento na interface (ex: ‚ÄúAltera√ß√µes salvas automaticamente‚Äù ou ‚ÄúSalvando...‚Äù).

Em caso de erro, exibir uma notifica√ß√£o amig√°vel, mas registrar o erro completo no console para depura√ß√£o.

‚öôÔ∏è Requisitos T√©cnicos de Implementa√ß√£o

Frontend (JavaScript / ReportsAutoSave.js)

Refatorar o m√©todo collectFormData() para coletar todos os campos listados acima, incluindo checklist e imagens.

Corrigir o erro TypeError: this.getChecklistData is not a function ‚Äî criar e vincular corretamente o m√©todo getChecklistData() para retornar todos os itens do checklist com seus respectivos estados e observa√ß√µes.

Implementar performSave() para enviar os dados para o endpoint /api/reports/autosave com POST ou PATCH conforme o relat√≥rio j√° existir ou n√£o.

Incluir tratamento para upload de imagens (multipart/form-data), salvando o v√≠nculo com o relat√≥rio ativo.

Garantir que, ao editar um relat√≥rio existente, as imagens e campos sejam preenchidos automaticamente com os dados do backend.

Backend (FastAPI / Python)

Criar ou ajustar endpoint /api/reports/autosave:

Receber dados parciais (JSON ou multipart) e atualizar o relat√≥rio existente.

Se o relat√≥rio n√£o existir, criar um novo em estado ‚Äúem preenchimento‚Äù.

Atualizar todos os campos de forma incremental.

Processar imagens recebidas e vincular √† tabela foto_relatorio.

Retornar o estado atualizado do relat√≥rio ap√≥s cada salvamento.

Se necess√°rio, criar/ajustar modelo SQLAlchemy Relatorio e FotoRelatorio para incluir campos adicionais.

Banco de Dados (Alembic)

Se houver campos faltando (ex: descricao, lembrete_proxima_visita, categoria, local, checklist_data, etc.), gerar novo arquivo Alembic com revision --autogenerate para manter compatibilidade com a vers√£o atual.

Garantir integridade relacional entre relatorios e foto_relatorio.

Performance

Utilizar atualiza√ß√£o incremental: apenas campos alterados devem ser enviados e atualizados.

Evitar sobrescrever campos n√£o modificados.

‚úÖ Resultado Esperado

O relat√≥rio come√ßa a ser salvo automaticamente assim que o usu√°rio inicia o preenchimento.

Todas as informa√ß√µes digitadas, imagens enviadas, checklists e lembretes s√£o gravados no banco de dados sem necessidade de clique em ‚ÄúConcluir Relat√≥rio‚Äù.

Ao retornar para a tela de edi√ß√£o, todas as informa√ß√µes e imagens s√£o carregadas corretamente.

Nenhum erro como getChecklistData is not a function ou falha de sincroniza√ß√£o ocorre.

O sistema exibe feedback visual indicando o status de salvamento.