Corre√ß√£o de Categorias por Obra nos Relat√≥rios

As categorias atualmente est√£o hardcoded no sistema (ex: Torre 1, Torre 2, √Årea Comum, Piscina). Isso gera os seguintes problemas:

‚úÖ Categorias fixas n√£o podem ser editadas ou exclu√≠das.

‚úÖ Categorias personalizadas adicionadas por obra n√£o aparecem ao criar relat√≥rios.

‚úÖ N√£o h√° v√≠nculo direto no banco de dados, dificultando a gest√£o individual por projeto.

üîπ Objetivo

Corrigir a gest√£o de categorias de fotos/relat√≥rios, garantindo que:

N√£o existam mais categorias hardcoded.

Cada obra tenha suas pr√≥prias categorias, armazenadas em banco.

Todas as categorias da obra apare√ßam corretamente ao criar relat√≥rios e ao subir fotos.

Categorias possam ser criadas, editadas e exclu√≠das por projeto sem impactar outras obras.

üîπ Altera√ß√µes necess√°rias
1. Banco de Dados (PostgreSQL + Alembic)

Criar (ou corrigir) a tabela categorias_obra com os campos:

id SERIAL PRIMARY KEY
projeto_id INTEGER REFERENCES projetos(id) ON DELETE CASCADE
nome_categoria VARCHAR NOT NULL
ordem INTEGER DEFAULT 0
created_at TIMESTAMP DEFAULT NOW()
updated_at TIMESTAMP DEFAULT NOW()


Migrar todas categorias hardcoded (Torre 1, Torre 2, √Årea Comum, Piscina) para registros iniciais em categorias_obra, vinculando a cada projeto que j√° existe no banco.

2. Backend (Flask)

Remover completamente qualquer refer√™ncia hardcoded de categorias no c√≥digo.

Substituir pelo carregamento din√¢mico:

categorias = CategoriasObra.query.filter_by(projeto_id=projeto.id).order_by(CategoriasObra.ordem).all()


Ajustar os endpoints:

/projetos/<id>/categorias ‚Üí Listar categorias da obra.

/projetos/<id>/categorias/add ‚Üí Criar categoria.

/projetos/<id>/categorias/<cat_id>/edit ‚Üí Editar categoria.

/projetos/<id>/categorias/<cat_id>/delete ‚Üí Excluir categoria.

3. Frontend (Templates + JS)

No formul√°rio de cria√ß√£o de relat√≥rios, carregar dinamicamente as categorias da obra selecionada.

Na tela de configura√ß√£o do projeto, adicionar CRUD completo para gerenciar categorias:

‚ûï Adicionar categoria

‚úèÔ∏è Editar categoria

üóë Excluir categoria

Garantir que ao excluir uma categoria usada em relat√≥rios antigos, os relat√≥rios mantenham hist√≥rico sem quebrar.

4. Integra√ß√£o com Relat√≥rios e Upload de Fotos

No campo ‚ÄúCategoria padr√£o para novas fotos‚Äù, exibir apenas as categorias da obra corrente.

Garantir que ao criar ou editar relat√≥rio, todas as categorias personalizadas da obra apare√ßam.

Upload de fotos deve obrigatoriamente associar a categoria ao projeto_id.

5. Regras de Neg√≥cio

Cada obra tem sua lista de categorias independente.

N√£o permitir duplica√ß√£o de categorias com mesmo nome dentro da mesma obra.

Ordem configur√°vel pelo campo ordem.

Hist√≥rico preservado ao excluir (n√£o apagar em cascata fotos/relat√≥rios j√° vinculados).

üîπ Resultado esperado

Categorias n√£o ser√£o mais hardcoded.

Cada obra ter√° sua lista pr√≥pria, edit√°vel e independente.

Todas categorias cadastradas de uma obra aparecer√£o automaticamente na cria√ß√£o de relat√≥rios e upload de fotos.

Usu√°rios poder√£o adicionar, editar e excluir categorias livremente por obra.

üìå Resumo para dev (a√ß√£o imediata):
‚ÄúRemover categorias fixas do c√≥digo, criar v√≠nculo din√¢mico via tabela categorias_obra, garantir CRUD por obra e exibi√ß√£o correta nas telas de cria√ß√£o/edi√ß√£o de relat√≥rios e upload de fotos.‚Äù