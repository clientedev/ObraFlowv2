ReorganizaÃ§Ã£o da Listagem de Obras e RemoÃ§Ã£o de â€œObras PrÃ³ximasâ€
ğŸ¯ Objetivo

Eliminar a duplicidade de listagem no dashboard e centralizar a visualizaÃ§Ã£o de obras na rota /projects, priorizando proximidade geogrÃ¡fica e status ativo.

âš™ï¸ Etapa 1 â€” Backend (Flask)
ğŸ”¹1.1. Remover a seÃ§Ã£o â€œObras PrÃ³ximasâ€ do Dashboard

No arquivo routes.py, localize a funÃ§Ã£o relacionada Ã  rota do dashboard principal (/dashboard ou /home).

Ela deve conter algo como:

@app.route('/dashboard')
@login_required
def dashboard():
    obras_proximas = get_obras_proximas(current_user)
    return render_template('dashboard.html', obras_proximas=obras_proximas, ...)


Substitua por:

@app.route('/dashboard')
@login_required
def dashboard():
    # Remove a lÃ³gica de obras prÃ³ximas
    return render_template('dashboard.html')


E no arquivo templates/dashboard.html, remova o bloco HTML que exibe as obras prÃ³ximas, algo semelhante a:

{% if obras_proximas %}
<div class="card mt-3">
    <div class="card-header">
        <i class="fa fa-map-marker-alt"></i> Obras PrÃ³ximas
    </div>
    <div class="card-body">
        {% for obra in obras_proximas %}
            ...
        {% endfor %}
    </div>
</div>
{% endif %}


ğŸ§¹ Esse trecho deve ser completamente excluÃ­do.

âš™ï¸ Etapa 2 â€” Atualizar a rota /projects para usar ordenaÃ§Ã£o por proximidade

A lÃ³gica que antes estava em get_obras_proximas() deve ser migrada para a listagem principal de obras.

Substitua o conteÃºdo da funÃ§Ã£o /projects por algo como:

from geopy.distance import geodesic

@app.route("/projects")
@login_required
def project_list():
    user_location = get_user_location(current_user)  # ObtÃ©m a posiÃ§Ã£o atual do usuÃ¡rio
    all_projects = Project.query.all()

    projetos_com_distancia = []

    for project in all_projects:
        # Verifica se o projeto possui localizaÃ§Ã£o
        if project.latitude and project.longitude and user_location:
            distancia = geodesic(
                (user_location.lat, user_location.lon),
                (project.latitude, project.longitude)
            ).km
        else:
            distancia = float('inf')  # Caso nÃ£o tenha localizaÃ§Ã£o, joga para o final

        projetos_com_distancia.append((project, distancia))

    # Ordenar:
    # 1. Obras ativas primeiro
    # 2. Depois por menor distÃ¢ncia
    # 3. Obras concluÃ­das por Ãºltimo
    projetos_com_distancia.sort(
        key=lambda x: (
            0 if x[0].status.lower() == "ativo" else 1,
            x[1]
        )
    )

    projetos_ordenados = [p[0] for p in projetos_com_distancia]

    return render_template(
        "projects/list.html",
        projects=projetos_ordenados
    )

ğŸ§± Etapa 3 â€” Template /templates/projects/list.html

Atualize o layout de listagem para remover botÃµes redundantes e deixar o card inteiro clicÃ¡vel.

{% for project in projects %}
<div class="project-card"
     onclick="window.location.href='{{ url_for('project_view', id=project.id) }}'">
    <div class="d-flex justify-content-between align-items-center mb-2">
        <span class="fw-bold text-primary">{{ project.codigo }}</span>
        <span class="badge {{ 'bg-success' if project.status == 'Ativo' else 'bg-secondary' }}">
            {{ project.status }}
        </span>
    </div>
    <div>
        <h5 class="mb-1">{{ project.nome }}</h5>
        <p class="mb-0 small text-muted">{{ project.empresa or '' }}</p>
    </div>
</div>
{% endfor %}


Remova quaisquer botÃµes como:

<a href="..." class="btn btn-outline-primary">Ver</a>
<a href="..." class="btn btn-outline-secondary">Editar</a>

ğŸ’… Etapa 4 â€” CSS simples para os cards clicÃ¡veis

Adicione no style ou CSS do projeto:

.project-card {
    background: #fff;
    border-radius: 8px;
    padding: 14px;
    margin-bottom: 12px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    cursor: pointer;
    transition: 0.2s ease-in-out;
}
.project-card:hover {
    background-color: #f3f6fa;
    transform: translateY(-2px);
}

ğŸ” Etapa 5 â€” Controle de acesso para â€œEditar Obraâ€

Somente o usuÃ¡rio master pode editar:

{% if current_user.role == 'master' %}
  <a href="{{ url_for('project_edit', id=project.id) }}" class="btn btn-primary">
    Editar Obra
  </a>
{% endif %}

âœ… Resultado Esperado
Comportamento	Resultado
Dashboard	Sem seÃ§Ã£o de â€œObras PrÃ³ximasâ€
/projects	Lista todas as obras, ordenadas por proximidade e status ativo/concluÃ­do
Card de obra	Inteiro clicÃ¡vel (leva Ã  tela de visualizaÃ§Ã£o)
BotÃµes â€œver/editarâ€ na lista	Removidos
BotÃ£o â€œEditar Obraâ€	Aparece apenas dentro da visualizaÃ§Ã£o e somente para usuÃ¡rios master
Obras sem coordenadas	Listadas por Ãºltimo
ğŸ§¾ Resumo TÃ©cnico Final
âœ” Remover seÃ§Ã£o â€œObras PrÃ³ximasâ€ do dashboard
âœ” Migrar cÃ¡lculo de distÃ¢ncia para rota /projects
âœ” Ordenar por proximidade e status ativo
âœ” Card de obra clicÃ¡vel
âœ” BotÃ£o de ediÃ§Ã£o restrito ao usuÃ¡rio master
âœ” Layout simplificado e unificado