Corrigir exclusivamente a funcionalidade de numeraÃ§Ã£o dos relatÃ³rios no sistema ELP, garantindo o seguinte comportamento:

ğŸ”§ Requisitos funcionais

NumeraÃ§Ã£o automÃ¡tica e sequencial por obra (projeto):

Cada obra deve manter sua prÃ³pria sequÃªncia independente:

Projeto X â†’ REL-0001, REL-0002, REL-0003â€¦

Projeto Y â†’ REL-0001, REL-0002, etc.

A sequÃªncia deve ser calculada com base no maior nÃºmero existente para aquele projeto no banco PostgreSQL, na tabela relatorios.

NumeraÃ§Ã£o prÃ©-preenchida e editÃ¡vel:

Ao criar um relatÃ³rio em â€œpreenchimentoâ€, o campo â€œnÃºmeroâ€ deve vir automaticamente preenchido com o prÃ³ximo nÃºmero disponÃ­vel, mas deve ser editÃ¡vel manualmente.

Se o usuÃ¡rio editar o nÃºmero manualmente, o sistema deve ajustar a sequÃªncia automaticamente a partir do novo valor digitado.

PersistÃªncia e visibilidade correta:

Os relatÃ³rios jÃ¡ criados nÃ£o podem desaparecer da listagem ao abrir novos relatÃ³rios para a mesma obra.

A listagem /reports deve sempre carregar todos os relatÃ³rios relacionados ao projeto, independentemente do status (â€œpreenchimentoâ€, â€œaguardando aprovaÃ§Ã£oâ€, etc.).

ğŸ§± Banco de dados

Tabela: relatorios
Colunas principais:

id (PK)

numero (string, ex: REL-0001)

projeto_id (FK â†’ projetos.id)

status

created_at

updated_at

ğŸ§  LÃ³gica esperada

Na criaÃ§Ã£o (new report):

Buscar o Ãºltimo nÃºmero (numero) de relatÃ³rio do mesmo projeto_id.

Incrementar +1 e formatar com 4 dÃ­gitos (REL-{num:04d}).

Preencher automaticamente no campo, mas permitir ediÃ§Ã£o antes do submit.

Na ediÃ§Ã£o (edit report):

Se o campo â€œnÃºmeroâ€ for alterado, atualizar o valor e ajustar o contador interno para os prÃ³ximos relatÃ³rios.

Na listagem:

Exibir todos os relatÃ³rios existentes vinculados Ã  obra, em ordem decrescente por created_at ou numero.

Impedir que relatÃ³rios anteriores â€œdesapareÃ§amâ€ ao criar novos.

âœ… Importante

NÃ£o alterar outras funcionalidades do sistema (templates, upload de imagem, categorias, etc.).

Garantir compatibilidade com o banco PostgreSQL atual.

Criar migraÃ§Ã£o Alembic se necessÃ¡rio para garantir consistÃªncia do campo numero (varchar, Ãºnico por projeto).

Testar a funcionalidade em produÃ§Ã£o (/reports e /reports/new) e confirmar que:

O nÃºmero aparece corretamente ao criar.

Ã‰ editÃ¡vel.

SequÃªncia Ã© mantida apÃ³s ediÃ§Ã£o.

RelatÃ³rios nÃ£o desaparecem da listagem.